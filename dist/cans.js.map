{"version":3,"file":"cans.js","sources":["../src/cansf.js","../src/letter-spacing.js","../src/index.js"],"sourcesContent":["// canvas 静态方法\nconst px2Num = function (val) {\n  return ~~val.replace(/([\\d]+)px/, '$1')\n}\nconst percent2Num = function (v) {\n  return ~~v.replace('%', '') / 100\n}\n\nclass Cansf {\n  constructor (canvas) {\n    this.canvas = canvas || document.createElement('canvas')\n    this.ctx = this.canvas.getContext('2d')\n    this.cache = {}\n    this.drawImage = async (source, x, y, w, h, props = {}) => {\n      let { border, shadow, borderRadius, callback } = props\n      let bw = 0\n      if (shadow) {\n        this.setShadow(shadow)\n      } else {\n        this.setShadow('0 0 0 transparent')\n      }\n      if (border) {\n        let [, borderWidth, borderStyle, borderColor] = border.match(/([\\d]+(px)?)\\s+(solid|dashed)\\s+([#\\w\\d]+)/)\n        this.ctx.strokeStyle = borderColor\n        bw = px2Num(borderWidth)\n        this.ctx.lineWidth = bw\n        borderStyle === 'dashed' && this.ctx.setLineDash([2, 2])\n      }\n      let img = await this.getCache(source)\n      if (borderRadius) {\n        let canvas = this.imageRadiusClip(img, borderRadius)\n        this.ctx.drawImage(canvas, x, y, w, h)\n        border && this.borderRadiusClip(x, y, w, h , borderRadius)\n      } else{\n        this.ctx.drawImage(img, x, y, w, h)\n        bw && this.ctx.strokeRect(x - bw / 2, y - bw / 2, w + bw, h + bw)\n      }\n      callback && await callback(this)\n    }\n    this.drawLine = async (sx, sy, ex, ey, w, color, style, shadow, callback) => {\n      if (shadow) {\n        this.setShadow(shadow)\n      } else {\n        this.setShadow('0 0 0 transparent')\n      }\n      style === 'dashed' && this.ctx.setLineDash([2, 2])\n      this.ctx.beginPath()\n      this.ctx.moveTo(sx,sy)\n      this.ctx.lineWidth = w\n      this.ctx.lineTo(ex, ey)\n      this.ctx.strokeStyle = color\n      this.ctx.stroke()\n      callback && await callback(this)\n    }\n    this.drawText = async (text, x, y, props = {}) => {\n      let { color = '#000', fontSize = '10px', fontWeight = '', fontStyle = '', letterSpacing = '',\n       width, textAlign = 'left', hasBreak = false, lineHeight, shadow, callback} = props\n      if (shadow) {\n        this.setShadow(shadow)\n      } else {\n        this.setShadow('0 0 0 transparent')\n      }\n      this.ctx.font = `${fontStyle} ${fontWeight} ${fontSize} PingFangSC-Regular`\n      this.ctx.fillStyle = color\n      if (width) {\n        for (let i = 0; i < text.length; i++) {\n          if (this.ctx.measureText(text.slice(0, i + 1)).width > width) {\n            this.drawText(text.slice(0, i), x, y, {\n              ...props,\n              hasBreak: true\n            })\n            lineHeight = lineHeight ? px2Num(lineHeight) : px2Num(fontSize)\n            this.drawText(text.slice(i), x, y + lineHeight, props)\n            return\n          }\n        }\n      }\n      if (textAlign) {\n        this.ctx.textAlign = textAlign\n      }\n      if (width || hasBreak) {\n        switch (textAlign) {\n          case 'right':\n            x = x + width\n            break\n          case 'center':\n            x = (x + width) / 2\n            break\n        }\n      }\n      letterSpacing\n      ? this.ctx.letterSpacingText(text, x, y + ~~fontSize.replace(/([\\d]+)px/, '$1'), ~~px2Num(letterSpacing))\n      : this.ctx.fillText(text, x, y + ~~fontSize.replace(/([\\d]+)px/, '$1'))\n      callback && await callback(this, this.ctx.measureText(text))\n\n    }\n    this.reset = () => {\n      this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height)\n    }\n  }\n  async loadImg (src) {\n    return new Promise((resolve, reject) => {\n      let img = new Image()\n      if (!this.isBase64(src) && !this.isSomeHost(src)) {\n        img.crossOrigin = 'Anonymous'\n      }\n      img.src = src\n      img.addEventListener('load', loadEvt)\n      img.addEventListener('error', errorEvt)\n      function loadEvt () {\n        removeEvt()\n        return resolve(img)\n      }\n      function errorEvt() {\n        console.error('loadImg 图片加载失败: ' + src)\n        removeEvt()\n        return resolve()\n      }\n      function removeEvt () {\n        img.removeEventListener('load', loadEvt)\n        img.removeEventListener('error', errorEvt)\n      }\n    })\n  }\n  async getCache (source) {\n    if (typeof source === 'string') {\n      let key = this.isBase64(source) ? source.slice(-18) : source\n      if (!Object.hasOwnProperty(this.cache, key)) {\n        let img = await this.loadImg(source)\n        if (img) {\n          this.cache[key] = img\n        }\n      }\n      return this.cache[key] || null\n    } else {\n      return source\n    }\n    \n  }\n  isBase64 (src) {\n    return /^data:image\\/jpg;base64,/.test(src)\n  }\n  isSomeHost (src) {\n    let result = src.match(/^https?:\\/\\/[^\\/\\?#:]+/)\n    if (result && result[0] === window.location.hostname) {\n      return true\n    } else {\n      return false\n    }\n  }\n  imageRadiusClip (imgObj, r) {\n    let canvas = document.createElement('canvas')\n    let w = imgObj.width\n    let h = imgObj.height\n    canvas.width = w\n    canvas.height = h\n    let ctx = canvas.getContext('2d')\n    let pattern = ctx.createPattern(imgObj, 'no-repeat')\n    let min_size = Math.min(w, h)\n    let x = 0\n    let y = 0\n    r = min_size * percent2Num(r)\n    if (r > min_size / 2) r = min_size / 2\n    // 开始绘制\n    ctx.beginPath()\n    ctx.moveTo(x + r, y)\n    ctx.arcTo(x + w, y, x + w, y + h, r)\n    ctx.arcTo(x + w, y + h, x, y + h, r)\n    ctx.arcTo(x, y + h, x, y, r)\n    ctx.arcTo(x, y, x + w, y, r)\n    ctx.closePath()\n    ctx.fillStyle = pattern\n    ctx.fill()\n    return canvas\n  }\n  borderRadiusClip (x, y, w, h, r) {\n    let min_size = Math.min(w, h)\n    r = min_size * percent2Num(r)\n    this.ctx.beginPath()\n    this.ctx.moveTo(x + r, y)\n    this.ctx.arcTo(x + w, y, x + w, y + h, r)\n    this.ctx.arcTo(x + w, y + h, x, y + h, r)\n    this.ctx.arcTo(x, y + h, x, y, r)\n    this.ctx.arcTo(x, y, x + w, y, r)\n    this.ctx.closePath()\n    this.ctx.stroke()\n  }\n  setShadow (shadow) {\n    let [,shadowOffsetX, shadowOffsetY, shadowBlur, shadowColor]  = (shadow || {}).match(/([\\d]+)[\\s]+([\\d]+)[\\s]+([\\d]+)[\\s]+([rgba#()\\d,\\.\\s\\w]+)/)\n    this.ctx.shadowOffsetX = shadowOffsetX\n    this.ctx.shadowOffsetY = shadowOffsetY\n    this.ctx.shadowBlur = shadowBlur\n    this.ctx.shadowColor = shadowColor\n  }\n  output (tiny) {\n    if (!tiny) {\n      return this.canvas.toDataURL()\n    } else {\n      return this.canvas.toDataURL('image/jpeg', tiny)\n    }\n  }\n}\nexport default Cansf","/**\n* @author zhangxinxu(.com)\n* @licence MIT\n* @description http://www.zhangxinxu.com/wordpress/?p=7362\n*/\nCanvasRenderingContext2D.prototype.letterSpacingText = function (text, x, y, letterSpacing) {\n  var context = this;\n  var canvas = context.canvas;\n  \n  if (!letterSpacing && canvas) {\n      letterSpacing = parseFloat(window.getComputedStyle(canvas).letterSpacing);\n  }\n  if (!letterSpacing) {\n      return this.fillText(text, x, y);\n  }\n  \n  var arrText = text.split('');\n  var align = context.textAlign || 'left';\n  \n  // 这里仅考虑水平排列\n  var originWidth = context.measureText(text).width;\n  // 应用letterSpacing占据宽度\n  var actualWidth = originWidth + letterSpacing * (arrText.length - 1);\n  // 根据水平对齐方式确定第一个字符的坐标\n  if (align == 'center') {\n      x = x - actualWidth / 2;\n  } else if (align == 'right') {\n      x = x - actualWidth;\n  }\n  \n  // 临时修改为文本左对齐\n  context.textAlign = 'left';\n  // 开始逐字绘制\n  arrText.forEach(function (letter) {\n      var letterWidth = context.measureText(letter).width;\n      context.fillText(letter, x, y);\n      // 确定下一个字符的横坐标\n      x = x + letterWidth + letterSpacing;\n  });\n  // 对齐方式还原\n  context.textAlign = align;\n};","import Cansf from './cansf'\nimport './letter-spacing'\nconst Cans = class Cans extends Cansf{\n  constructor (canvas) {\n    super(canvas)\n    this.render = async (config) => {\n      this.setCanvas(config)\n      await this.resolveImages(config.images)\n      await this.resolveTexts(config.texts)\n      await this.resolveLines(config.lines)\n      return this\n    }\n  }\n  setCanvas ({background, width, height}) {\n    width && (this.canvas.width = width)\n    height && (this.canvas.height = height)\n    this.ctx.fillStyle = background\n    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height)\n  }\n  async resolveLines (lines = []) {\n    for (let i = 0; i < lines.length; i++) {\n      let {sx, sy, ex, ey, lineWidth, color, style, shadow, callback} = lines[i]\n      await this.drawLine(sx, sy, ex, ey, lineWidth, color, style, shadow, callback)\n    }\n  }\n  async resolveTexts (texts = []) {\n    for (let i = 0; i < texts.length; i++) {\n      let { text, x, y, ...arg } = texts[i]\n      await this.drawText(text, x, y, arg)\n    }\n  }\n  async resolveImages (images = []) {\n    let res = await Promise.all(images.map(v => this.getCache(v.source)))\n    for (let i = 0; i < res.length; i++) {\n      let img = res[i]\n      if (!img) {\n        console.error('图片加载失败 无法渲染: ' + images[i].source)\n        break\n      }\n      const {x, y, width, height, border, shadow, borderRadius, callback} = images[i]\n      await this.drawImage(\n        img,\n        x,\n        y,\n        width,\n        height,\n        {\n          border,\n          shadow,\n          borderRadius,\n          callback\n        }\n      )\n    }\n  }\n}\n\nexport default Cans"],"names":["px2Num","val","replace","percent2Num","v","Cansf","canvas","document","createElement","ctx","getContext","cache","drawImage","source","x","y","w","h","props","border","shadow","borderRadius","callback","bw","setShadow","match","borderWidth","borderStyle","borderColor","strokeStyle","lineWidth","setLineDash","getCache","img","imageRadiusClip","borderRadiusClip","strokeRect","drawLine","sx","sy","ex","ey","color","style","beginPath","moveTo","lineTo","stroke","drawText","text","fontSize","fontWeight","fontStyle","letterSpacing","width","textAlign","hasBreak","lineHeight","font","fillStyle","i","length","measureText","slice","letterSpacingText","fillText","reset","clearRect","height","src","Promise","resolve","reject","Image","isBase64","isSomeHost","crossOrigin","addEventListener","loadEvt","errorEvt","removeEvt","console","error","removeEventListener","key","Object","hasOwnProperty","loadImg","test","result","window","location","hostname","imgObj","r","pattern","createPattern","min_size","Math","min","arcTo","closePath","fill","shadowOffsetX","shadowOffsetY","shadowBlur","shadowColor","tiny","toDataURL","CanvasRenderingContext2D","prototype","context","parseFloat","getComputedStyle","arrText","split","align","originWidth","actualWidth","forEach","letter","letterWidth","Cans","render","config","setCanvas","resolveImages","images","resolveTexts","texts","resolveLines","lines","background","fillRect","arg","all","map","res"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAAA;EACA,IAAMA,MAAM,GAAG,SAATA,MAAS,CAAUC,GAAV,EAAe;EAC5B,SAAO,CAAC,CAACA,GAAG,CAACC,OAAJ,CAAY,WAAZ,EAAyB,IAAzB,CAAT;EACD,CAFD;;EAGA,IAAMC,WAAW,GAAG,SAAdA,WAAc,CAAUC,CAAV,EAAa;EAC/B,SAAO,CAAC,CAACA,CAAC,CAACF,OAAF,CAAU,GAAV,EAAe,EAAf,CAAF,GAAuB,GAA9B;EACD,CAFD;;MAIMG;;;EACJ,iBAAaC,MAAb,EAAqB;EAAA;;EAAA;;EACnB,SAAKA,MAAL,GAAcA,MAAM,IAAIC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAxB;EACA,SAAKC,GAAL,GAAW,KAAKH,MAAL,CAAYI,UAAZ,CAAuB,IAAvB,CAAX;EACA,SAAKC,KAAL,GAAa,EAAb;;EACA,SAAKC,SAAL;EAAA;EAAA;EAAA;EAAA;EAAA,8BAAiB,iBAAOC,MAAP,EAAeC,CAAf,EAAkBC,CAAlB,EAAqBC,CAArB,EAAwBC,CAAxB;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;;EAAA;EAAA;EAAA;EAAA;EAA2BC,gBAAAA,KAA3B,2DAAmC,EAAnC;EACTC,gBAAAA,MADS,GACkCD,KADlC,CACTC,MADS,EACDC,MADC,GACkCF,KADlC,CACDE,MADC,EACOC,YADP,GACkCH,KADlC,CACOG,YADP,EACqBC,QADrB,GACkCJ,KADlC,CACqBI,QADrB;EAEXC,gBAAAA,EAFW,GAEN,CAFM;;EAGf,oBAAIH,MAAJ,EAAY;EACV,kBAAA,KAAI,CAACI,SAAL,CAAeJ,MAAf;EACD,iBAFD,MAEO;EACL,kBAAA,KAAI,CAACI,SAAL,CAAe,mBAAf;EACD;;EACD,oBAAIL,MAAJ,EAAY;EAAA,kCACsCA,MAAM,CAACM,KAAP,CAAa,4CAAb,CADtC,qDACHC,WADG,sBACUC,WADV,sBACuBC,WADvB;EAEV,kBAAA,KAAI,CAACnB,GAAL,CAASoB,WAAT,GAAuBD,WAAvB;EACAL,kBAAAA,EAAE,GAAGvB,MAAM,CAAC0B,WAAD,CAAX;EACA,kBAAA,KAAI,CAACjB,GAAL,CAASqB,SAAT,GAAqBP,EAArB;EACAI,kBAAAA,WAAW,KAAK,QAAhB,IAA4B,KAAI,CAAClB,GAAL,CAASsB,WAAT,CAAqB,CAAC,CAAD,EAAI,CAAJ,CAArB,CAA5B;EACD;;EAdc;EAAA,uBAeC,KAAI,CAACC,QAAL,CAAcnB,MAAd,CAfD;;EAAA;EAeXoB,gBAAAA,GAfW;;EAgBf,oBAAIZ,YAAJ,EAAkB;EACZf,kBAAAA,OADY,GACH,KAAI,CAAC4B,eAAL,CAAqBD,GAArB,EAA0BZ,YAA1B,CADG;;EAEhB,kBAAA,KAAI,CAACZ,GAAL,CAASG,SAAT,CAAmBN,OAAnB,EAA2BQ,CAA3B,EAA8BC,CAA9B,EAAiCC,CAAjC,EAAoCC,CAApC;;EACAE,kBAAAA,MAAM,IAAI,KAAI,CAACgB,gBAAL,CAAsBrB,CAAtB,EAAyBC,CAAzB,EAA4BC,CAA5B,EAA+BC,CAA/B,EAAmCI,YAAnC,CAAV;EACD,iBAJD,MAIM;EACJ,kBAAA,KAAI,CAACZ,GAAL,CAASG,SAAT,CAAmBqB,GAAnB,EAAwBnB,CAAxB,EAA2BC,CAA3B,EAA8BC,CAA9B,EAAiCC,CAAjC;;EACAM,kBAAAA,EAAE,IAAI,KAAI,CAACd,GAAL,CAAS2B,UAAT,CAAoBtB,CAAC,GAAGS,EAAE,GAAG,CAA7B,EAAgCR,CAAC,GAAGQ,EAAE,GAAG,CAAzC,EAA4CP,CAAC,GAAGO,EAAhD,EAAoDN,CAAC,GAAGM,EAAxD,CAAN;EACD;;EAvBc,8BAwBfD,QAxBe;;EAAA;EAAA;EAAA;EAAA;;EAAA;EAAA,uBAwBGA,QAAQ,CAAC,KAAD,CAxBX;;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA,OAAjB;;EAAA;EAAA;EAAA;EAAA;;EA0BA,SAAKe,QAAL;EAAA;EAAA;EAAA;EAAA;EAAA,8BAAgB,kBAAOC,EAAP,EAAWC,EAAX,EAAeC,EAAf,EAAmBC,EAAnB,EAAuBzB,CAAvB,EAA0B0B,KAA1B,EAAiCC,KAAjC,EAAwCvB,MAAxC,EAAgDE,QAAhD;EAAA;EAAA;EAAA;EAAA;EACd,oBAAIF,MAAJ,EAAY;EACV,kBAAA,KAAI,CAACI,SAAL,CAAeJ,MAAf;EACD,iBAFD,MAEO;EACL,kBAAA,KAAI,CAACI,SAAL,CAAe,mBAAf;EACD;;EACDmB,gBAAAA,KAAK,KAAK,QAAV,IAAsB,KAAI,CAAClC,GAAL,CAASsB,WAAT,CAAqB,CAAC,CAAD,EAAI,CAAJ,CAArB,CAAtB;;EACA,gBAAA,KAAI,CAACtB,GAAL,CAASmC,SAAT;;EACA,gBAAA,KAAI,CAACnC,GAAL,CAASoC,MAAT,CAAgBP,EAAhB,EAAmBC,EAAnB;;EACA,gBAAA,KAAI,CAAC9B,GAAL,CAASqB,SAAT,GAAqBd,CAArB;;EACA,gBAAA,KAAI,CAACP,GAAL,CAASqC,MAAT,CAAgBN,EAAhB,EAAoBC,EAApB;;EACA,gBAAA,KAAI,CAAChC,GAAL,CAASoB,WAAT,GAAuBa,KAAvB;;EACA,gBAAA,KAAI,CAACjC,GAAL,CAASsC,MAAT;;EAZc,+BAadzB,QAbc;;EAAA;EAAA;EAAA;EAAA;;EAAA;EAAA,uBAaIA,QAAQ,CAAC,KAAD,CAbZ;;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA,OAAhB;;EAAA;EAAA;EAAA;EAAA;;EAeA,SAAK0B,QAAL;EAAA;EAAA;EAAA;EAAA;EAAA,8BAAgB,kBAAOC,IAAP,EAAanC,CAAb,EAAgBC,CAAhB;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;;EAAA;EAAA;EAAA;EAAA;EAAmBG,gBAAAA,KAAnB,8DAA2B,EAA3B;EAAA,+BAEgEA,KAFhE,CACRwB,KADQ,EACRA,KADQ,6BACA,MADA,mCAEgExB,KAFhE,CACQgC,QADR,EACQA,QADR,gCACmB,MADnB,wCAEgEhC,KAFhE,CAC2BiC,UAD3B,EAC2BA,UAD3B,kCACwC,EADxC,yCAEgEjC,KAFhE,CAC4CkC,SAD5C,EAC4CA,SAD5C,iCACwD,EADxD,4CAEgElC,KAFhE,CAC4DmC,aAD5D,EAC4DA,aAD5D,qCAC4E,EAD5E,yBAEbC,KAFa,GAEgEpC,KAFhE,CAEboC,KAFa,qBAEgEpC,KAFhE,CAENqC,SAFM,EAENA,SAFM,iCAEM,MAFN,uCAEgErC,KAFhE,CAEcsC,QAFd,EAEcA,QAFd,gCAEyB,KAFzB,oBAEgCC,UAFhC,GAEgEvC,KAFhE,CAEgCuC,UAFhC,EAE4CrC,MAF5C,GAEgEF,KAFhE,CAE4CE,MAF5C,EAEoDE,QAFpD,GAEgEJ,KAFhE,CAEoDI,QAFpD;;EAGd,oBAAIF,MAAJ,EAAY;EACV,kBAAA,KAAI,CAACI,SAAL,CAAeJ,MAAf;EACD,iBAFD,MAEO;EACL,kBAAA,KAAI,CAACI,SAAL,CAAe,mBAAf;EACD;;EACD,gBAAA,KAAI,CAACf,GAAL,CAASiD,IAAT,aAAmBN,SAAnB,cAAgCD,UAAhC,cAA8CD,QAA9C;EACA,gBAAA,KAAI,CAACzC,GAAL,CAASkD,SAAT,GAAqBjB,KAArB;;EATc,qBAUVY,KAVU;EAAA;EAAA;EAAA;;EAWHM,gBAAAA,CAXG,GAWC,CAXD;;EAAA;EAAA,sBAWIA,CAAC,GAAGX,IAAI,CAACY,MAXb;EAAA;EAAA;EAAA;;EAAA,sBAYN,KAAI,CAACpD,GAAL,CAASqD,WAAT,CAAqBb,IAAI,CAACc,KAAL,CAAW,CAAX,EAAcH,CAAC,GAAG,CAAlB,CAArB,EAA2CN,KAA3C,GAAmDA,KAZ7C;EAAA;EAAA;EAAA;;EAaR,gBAAA,KAAI,CAACN,QAAL,CAAcC,IAAI,CAACc,KAAL,CAAW,CAAX,EAAcH,CAAd,CAAd,EAAgC9C,CAAhC,EAAmCC,CAAnC,oBACKG,KADL;EAEEsC,kBAAAA,QAAQ,EAAE;EAFZ;;EAIAC,gBAAAA,UAAU,GAAGA,UAAU,GAAGzD,MAAM,CAACyD,UAAD,CAAT,GAAwBzD,MAAM,CAACkD,QAAD,CAArD;;EACA,gBAAA,KAAI,CAACF,QAAL,CAAcC,IAAI,CAACc,KAAL,CAAWH,CAAX,CAAd,EAA6B9C,CAA7B,EAAgCC,CAAC,GAAG0C,UAApC,EAAgDvC,KAAhD;;EAlBQ;;EAAA;EAWqB0C,gBAAAA,CAAC,EAXtB;EAAA;EAAA;;EAAA;EAuBd,oBAAIL,SAAJ,EAAe;EACb,kBAAA,KAAI,CAAC9C,GAAL,CAAS8C,SAAT,GAAqBA,SAArB;EACD;;EAzBa,sBA0BVD,KAAK,IAAIE,QA1BC;EAAA;EAAA;EAAA;;EAAA,+BA2BJD,SA3BI;EAAA,kDA4BL,OA5BK,yBA+BL,QA/BK;EAAA;;EAAA;EA6BRzC,gBAAAA,CAAC,GAAGA,CAAC,GAAGwC,KAAR;EA7BQ;;EAAA;EAgCRxC,gBAAAA,CAAC,GAAG,CAACA,CAAC,GAAGwC,KAAL,IAAc,CAAlB;EAhCQ;;EAAA;EAoCdD,gBAAAA,aAAa,GACX,KAAI,CAAC5C,GAAL,CAASuD,iBAAT,CAA2Bf,IAA3B,EAAiCnC,CAAjC,EAAoCC,CAAC,GAAG,CAAC,CAACmC,QAAQ,CAAChD,OAAT,CAAiB,WAAjB,EAA8B,IAA9B,CAA1C,EAA+E,CAAC,CAACF,MAAM,CAACqD,aAAD,CAAvF,CADW,GAEX,KAAI,CAAC5C,GAAL,CAASwD,QAAT,CAAkBhB,IAAlB,EAAwBnC,CAAxB,EAA2BC,CAAC,GAAG,CAAC,CAACmC,QAAQ,CAAChD,OAAT,CAAiB,WAAjB,EAA8B,IAA9B,CAAjC,CAFF;EApCc,+BAuCdoB,QAvCc;;EAAA;EAAA;EAAA;EAAA;;EAAA;EAAA,uBAuCIA,QAAQ,CAAC,KAAD,EAAO,KAAI,CAACb,GAAL,CAASqD,WAAT,CAAqBb,IAArB,CAAP,CAvCZ;;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA,OAAhB;;EAAA;EAAA;EAAA;EAAA;;EA0CA,SAAKiB,KAAL,GAAa,YAAM;EACjB,MAAA,KAAI,CAACzD,GAAL,CAAS0D,SAAT,CAAmB,CAAnB,EAAsB,CAAtB,EAAyB,KAAI,CAAC7D,MAAL,CAAYgD,KAArC,EAA4C,KAAI,CAAChD,MAAL,CAAY8D,MAAxD;EACD,KAFD;EAGD;;;;;;;kDACcC;;;;;;;oDACN,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;EACtC,sBAAIvC,GAAG,GAAG,IAAIwC,KAAJ,EAAV;;EACA,sBAAI,CAAC,MAAI,CAACC,QAAL,CAAcL,GAAd,CAAD,IAAuB,CAAC,MAAI,CAACM,UAAL,CAAgBN,GAAhB,CAA5B,EAAkD;EAChDpC,oBAAAA,GAAG,CAAC2C,WAAJ,GAAkB,WAAlB;EACD;;EACD3C,kBAAAA,GAAG,CAACoC,GAAJ,GAAUA,GAAV;EACApC,kBAAAA,GAAG,CAAC4C,gBAAJ,CAAqB,MAArB,EAA6BC,OAA7B;EACA7C,kBAAAA,GAAG,CAAC4C,gBAAJ,CAAqB,OAArB,EAA8BE,QAA9B;;EACA,2BAASD,OAAT,GAAoB;EAClBE,oBAAAA,SAAS;EACT,2BAAOT,OAAO,CAACtC,GAAD,CAAd;EACD;;EACD,2BAAS8C,QAAT,GAAoB;EAClBE,oBAAAA,OAAO,CAACC,KAAR,CAAc,qBAAqBb,GAAnC;EACAW,oBAAAA,SAAS;EACT,2BAAOT,OAAO,EAAd;EACD;;EACD,2BAASS,SAAT,GAAsB;EACpB/C,oBAAAA,GAAG,CAACkD,mBAAJ,CAAwB,MAAxB,EAAgCL,OAAhC;EACA7C,oBAAAA,GAAG,CAACkD,mBAAJ,CAAwB,OAAxB,EAAiCJ,QAAjC;EACD;EACF,iBArBM;;;;;;;;;;;;;;;;;;;kDAuBOlE;;;;;;;wBACV,OAAOA,MAAP,KAAkB;;;;;EAChBuE,gBAAAA,MAAM,KAAKV,QAAL,CAAc7D,MAAd,IAAwBA,MAAM,CAACkD,KAAP,CAAa,CAAC,EAAd,CAAxB,GAA4ClD;;sBACjDwE,MAAM,CAACC,cAAP,CAAsB,KAAK3E,KAA3B,EAAkCyE,GAAlC;;;;;;yBACa,KAAKG,OAAL,CAAa1E,MAAb;;;EAAZoB,gBAAAA;;EACJ,oBAAIA,IAAJ,EAAS;EACP,uBAAKtB,KAAL,CAAWyE,GAAX,IAAkBnD,IAAlB;EACD;;;oDAEI,KAAKtB,KAAL,CAAWyE,GAAX,KAAmB;;;oDAEnBvE;;;;;;;;;;;;;;;;+BAIDwD,KAAK;EACb,aAAO,2BAA2BmB,IAA3B,CAAgCnB,GAAhC,CAAP;EACD;;;iCACWA,KAAK;EACf,UAAIoB,MAAM,GAAGpB,GAAG,CAAC5C,KAAJ,CAAU,wBAAV,CAAb;;EACA,UAAIgE,MAAM,IAAIA,MAAM,CAAC,CAAD,CAAN,KAAcC,MAAM,CAACC,QAAP,CAAgBC,QAA5C,EAAsD;EACpD,eAAO,IAAP;EACD,OAFD,MAEO;EACL,eAAO,KAAP;EACD;EACF;;;sCACgBC,QAAQC,GAAG;EAC1B,UAAIxF,MAAM,GAAGC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAb;EACA,UAAIQ,CAAC,GAAG6E,MAAM,CAACvC,KAAf;EACA,UAAIrC,CAAC,GAAG4E,MAAM,CAACzB,MAAf;EACA9D,MAAAA,MAAM,CAACgD,KAAP,GAAetC,CAAf;EACAV,MAAAA,MAAM,CAAC8D,MAAP,GAAgBnD,CAAhB;EACA,UAAIR,GAAG,GAAGH,MAAM,CAACI,UAAP,CAAkB,IAAlB,CAAV;EACA,UAAIqF,OAAO,GAAGtF,GAAG,CAACuF,aAAJ,CAAkBH,MAAlB,EAA0B,WAA1B,CAAd;EACA,UAAII,QAAQ,GAAGC,IAAI,CAACC,GAAL,CAASnF,CAAT,EAAYC,CAAZ,CAAf;EACA,UAAIH,CAAC,GAAG,CAAR;EACA,UAAIC,CAAC,GAAG,CAAR;EACA+E,MAAAA,CAAC,GAAGG,QAAQ,GAAG9F,WAAW,CAAC2F,CAAD,CAA1B;EACA,UAAIA,CAAC,GAAGG,QAAQ,GAAG,CAAnB,EAAsBH,CAAC,GAAGG,QAAQ,GAAG,CAAf,CAZI;;EAc1BxF,MAAAA,GAAG,CAACmC,SAAJ;EACAnC,MAAAA,GAAG,CAACoC,MAAJ,CAAW/B,CAAC,GAAGgF,CAAf,EAAkB/E,CAAlB;EACAN,MAAAA,GAAG,CAAC2F,KAAJ,CAAUtF,CAAC,GAAGE,CAAd,EAAiBD,CAAjB,EAAoBD,CAAC,GAAGE,CAAxB,EAA2BD,CAAC,GAAGE,CAA/B,EAAkC6E,CAAlC;EACArF,MAAAA,GAAG,CAAC2F,KAAJ,CAAUtF,CAAC,GAAGE,CAAd,EAAiBD,CAAC,GAAGE,CAArB,EAAwBH,CAAxB,EAA2BC,CAAC,GAAGE,CAA/B,EAAkC6E,CAAlC;EACArF,MAAAA,GAAG,CAAC2F,KAAJ,CAAUtF,CAAV,EAAaC,CAAC,GAAGE,CAAjB,EAAoBH,CAApB,EAAuBC,CAAvB,EAA0B+E,CAA1B;EACArF,MAAAA,GAAG,CAAC2F,KAAJ,CAAUtF,CAAV,EAAaC,CAAb,EAAgBD,CAAC,GAAGE,CAApB,EAAuBD,CAAvB,EAA0B+E,CAA1B;EACArF,MAAAA,GAAG,CAAC4F,SAAJ;EACA5F,MAAAA,GAAG,CAACkD,SAAJ,GAAgBoC,OAAhB;EACAtF,MAAAA,GAAG,CAAC6F,IAAJ;EACA,aAAOhG,MAAP;EACD;;;uCACiBQ,GAAGC,GAAGC,GAAGC,GAAG6E,GAAG;EAC/B,UAAIG,QAAQ,GAAGC,IAAI,CAACC,GAAL,CAASnF,CAAT,EAAYC,CAAZ,CAAf;EACA6E,MAAAA,CAAC,GAAGG,QAAQ,GAAG9F,WAAW,CAAC2F,CAAD,CAA1B;EACA,WAAKrF,GAAL,CAASmC,SAAT;EACA,WAAKnC,GAAL,CAASoC,MAAT,CAAgB/B,CAAC,GAAGgF,CAApB,EAAuB/E,CAAvB;EACA,WAAKN,GAAL,CAAS2F,KAAT,CAAetF,CAAC,GAAGE,CAAnB,EAAsBD,CAAtB,EAAyBD,CAAC,GAAGE,CAA7B,EAAgCD,CAAC,GAAGE,CAApC,EAAuC6E,CAAvC;EACA,WAAKrF,GAAL,CAAS2F,KAAT,CAAetF,CAAC,GAAGE,CAAnB,EAAsBD,CAAC,GAAGE,CAA1B,EAA6BH,CAA7B,EAAgCC,CAAC,GAAGE,CAApC,EAAuC6E,CAAvC;EACA,WAAKrF,GAAL,CAAS2F,KAAT,CAAetF,CAAf,EAAkBC,CAAC,GAAGE,CAAtB,EAAyBH,CAAzB,EAA4BC,CAA5B,EAA+B+E,CAA/B;EACA,WAAKrF,GAAL,CAAS2F,KAAT,CAAetF,CAAf,EAAkBC,CAAlB,EAAqBD,CAAC,GAAGE,CAAzB,EAA4BD,CAA5B,EAA+B+E,CAA/B;EACA,WAAKrF,GAAL,CAAS4F,SAAT;EACA,WAAK5F,GAAL,CAASsC,MAAT;EACD;;;gCACU3B,QAAQ;EAAA,mBAC+C,CAACA,MAAM,IAAI,EAAX,EAAeK,KAAf,CAAqB,2DAArB,CAD/C;EAAA;EAAA,UACX8E,aADW;EAAA,UACIC,aADJ;EAAA,UACmBC,UADnB;EAAA,UAC+BC,WAD/B;;EAEjB,WAAKjG,GAAL,CAAS8F,aAAT,GAAyBA,aAAzB;EACA,WAAK9F,GAAL,CAAS+F,aAAT,GAAyBA,aAAzB;EACA,WAAK/F,GAAL,CAASgG,UAAT,GAAsBA,UAAtB;EACA,WAAKhG,GAAL,CAASiG,WAAT,GAAuBA,WAAvB;EACD;;;6BACOC,MAAM;EACZ,UAAI,CAACA,IAAL,EAAW;EACT,eAAO,KAAKrG,MAAL,CAAYsG,SAAZ,EAAP;EACD,OAFD,MAEO;EACL,eAAO,KAAKtG,MAAL,CAAYsG,SAAZ,CAAsB,YAAtB,EAAoCD,IAApC,CAAP;EACD;EACF;;;;;;ECxMH;;;;;EAKAE,wBAAwB,CAACC,SAAzB,CAAmC9C,iBAAnC,GAAuD,UAAUf,IAAV,EAAgBnC,CAAhB,EAAmBC,CAAnB,EAAsBsC,aAAtB,EAAqC;EAC1F,MAAI0D,OAAO,GAAG,IAAd;EACA,MAAIzG,MAAM,GAAGyG,OAAO,CAACzG,MAArB;;EAEA,MAAI,CAAC+C,aAAD,IAAkB/C,MAAtB,EAA8B;EAC1B+C,IAAAA,aAAa,GAAG2D,UAAU,CAACtB,MAAM,CAACuB,gBAAP,CAAwB3G,MAAxB,EAAgC+C,aAAjC,CAA1B;EACH;;EACD,MAAI,CAACA,aAAL,EAAoB;EAChB,WAAO,KAAKY,QAAL,CAAchB,IAAd,EAAoBnC,CAApB,EAAuBC,CAAvB,CAAP;EACH;;EAED,MAAImG,OAAO,GAAGjE,IAAI,CAACkE,KAAL,CAAW,EAAX,CAAd;EACA,MAAIC,KAAK,GAAGL,OAAO,CAACxD,SAAR,IAAqB,MAAjC,CAZ0F;;EAe1F,MAAI8D,WAAW,GAAGN,OAAO,CAACjD,WAAR,CAAoBb,IAApB,EAA0BK,KAA5C,CAf0F;;EAiB1F,MAAIgE,WAAW,GAAGD,WAAW,GAAGhE,aAAa,IAAI6D,OAAO,CAACrD,MAAR,GAAiB,CAArB,CAA7C,CAjB0F;;EAmB1F,MAAIuD,KAAK,IAAI,QAAb,EAAuB;EACnBtG,IAAAA,CAAC,GAAGA,CAAC,GAAGwG,WAAW,GAAG,CAAtB;EACH,GAFD,MAEO,IAAIF,KAAK,IAAI,OAAb,EAAsB;EACzBtG,IAAAA,CAAC,GAAGA,CAAC,GAAGwG,WAAR;EACH,GAvByF;;;EA0B1FP,EAAAA,OAAO,CAACxD,SAAR,GAAoB,MAApB,CA1B0F;;EA4B1F2D,EAAAA,OAAO,CAACK,OAAR,CAAgB,UAAUC,MAAV,EAAkB;EAC9B,QAAIC,WAAW,GAAGV,OAAO,CAACjD,WAAR,CAAoB0D,MAApB,EAA4BlE,KAA9C;EACAyD,IAAAA,OAAO,CAAC9C,QAAR,CAAiBuD,MAAjB,EAAyB1G,CAAzB,EAA4BC,CAA5B,EAF8B;;EAI9BD,IAAAA,CAAC,GAAGA,CAAC,GAAG2G,WAAJ,GAAkBpE,aAAtB;EACH,GALD,EA5B0F;;EAmC1F0D,EAAAA,OAAO,CAACxD,SAAR,GAAoB6D,KAApB;EACD,CApCD;;ECHA,IAAMM,IAAI;EAAA;EAAA;EAAA;;EACR,gBAAapH,MAAb,EAAqB;EAAA;;EAAA;;EACnB,8EAAMA,MAAN;;EACA,UAAKqH,MAAL;EAAA;EAAA;EAAA;EAAA;EAAA,8BAAc,iBAAOC,MAAP;EAAA;EAAA;EAAA;EAAA;EACZ,sBAAKC,SAAL,CAAeD,MAAf;;EADY;EAAA,uBAEN,MAAKE,aAAL,CAAmBF,MAAM,CAACG,MAA1B,CAFM;;EAAA;EAAA;EAAA,uBAGN,MAAKC,YAAL,CAAkBJ,MAAM,CAACK,KAAzB,CAHM;;EAAA;EAAA;EAAA,uBAIN,MAAKC,YAAL,CAAkBN,MAAM,CAACO,KAAzB,CAJM;;EAAA;EAAA;;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA,OAAd;;EAAA;EAAA;EAAA;EAAA;;EAFmB;EASpB;;EAVO;EAAA;EAAA,qCAWgC;EAAA,UAA5BC,UAA4B,SAA5BA,UAA4B;EAAA,UAAhB9E,KAAgB,SAAhBA,KAAgB;EAAA,UAATc,MAAS,SAATA,MAAS;EACtCd,MAAAA,KAAK,KAAK,KAAKhD,MAAL,CAAYgD,KAAZ,GAAoBA,KAAzB,CAAL;EACAc,MAAAA,MAAM,KAAK,KAAK9D,MAAL,CAAY8D,MAAZ,GAAqBA,MAA1B,CAAN;EACA,WAAK3D,GAAL,CAASkD,SAAT,GAAqByE,UAArB;EACA,WAAK3H,GAAL,CAAS4H,QAAT,CAAkB,CAAlB,EAAqB,CAArB,EAAwB,KAAK/H,MAAL,CAAYgD,KAApC,EAA2C,KAAKhD,MAAL,CAAY8D,MAAvD;EACD;EAhBO;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;;EAAA;EAAA;EAAA;EAAA;EAiBY+D,gBAAAA,KAjBZ,8DAiBoB,EAjBpB;EAkBGvE,gBAAAA,CAlBH,GAkBO,CAlBP;;EAAA;EAAA,sBAkBUA,CAAC,GAAGuE,KAAK,CAACtE,MAlBpB;EAAA;EAAA;EAAA;;EAAA,2BAmB8DsE,KAAK,CAACvE,CAAD,CAnBnE,EAmBCtB,EAnBD,YAmBCA,EAnBD,EAmBKC,EAnBL,YAmBKA,EAnBL,EAmBSC,EAnBT,YAmBSA,EAnBT,EAmBaC,EAnBb,YAmBaA,EAnBb,EAmBiBX,SAnBjB,YAmBiBA,SAnBjB,EAmB4BY,KAnB5B,YAmB4BA,KAnB5B,EAmBmCC,KAnBnC,YAmBmCA,KAnBnC,EAmB0CvB,MAnB1C,YAmB0CA,MAnB1C,EAmBkDE,QAnBlD,YAmBkDA,QAnBlD;EAAA;EAAA,uBAoBE,KAAKe,QAAL,CAAcC,EAAd,EAAkBC,EAAlB,EAAsBC,EAAtB,EAA0BC,EAA1B,EAA8BX,SAA9B,EAAyCY,KAAzC,EAAgDC,KAAhD,EAAuDvB,MAAvD,EAA+DE,QAA/D,CApBF;;EAAA;EAkB4BsC,gBAAAA,CAAC,EAlB7B;EAAA;EAAA;;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;;EAAA;EAAA;EAAA;EAAA;EAuBYqE,gBAAAA,KAvBZ,8DAuBoB,EAvBpB;EAwBGrE,gBAAAA,CAxBH,GAwBO,CAxBP;;EAAA;EAAA,sBAwBUA,CAAC,GAAGqE,KAAK,CAACpE,MAxBpB;EAAA;EAAA;EAAA;;EAAA,2BAyByBoE,KAAK,CAACrE,CAAD,CAzB9B,EAyBEX,IAzBF,YAyBEA,IAzBF,EAyBQnC,CAzBR,YAyBQA,CAzBR,EAyBWC,CAzBX,YAyBWA,CAzBX,EAyBiBuH,GAzBjB;EAAA;EAAA,uBA0BE,KAAKtF,QAAL,CAAcC,IAAd,EAAoBnC,CAApB,EAAuBC,CAAvB,EAA0BuH,GAA1B,CA1BF;;EAAA;EAwB4B1E,gBAAAA,CAAC,EAxB7B;EAAA;EAAA;;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;;EAAA;EAAA;EAAA;EAAA;EA6BamE,gBAAAA,MA7Bb,8DA6BsB,EA7BtB;EAAA;EAAA,uBA8BUzD,OAAO,CAACiE,GAAR,CAAYR,MAAM,CAACS,GAAP,CAAW,UAAApI,CAAC;EAAA,yBAAI,MAAI,CAAC4B,QAAL,CAAc5B,CAAC,CAACS,MAAhB,CAAJ;EAAA,iBAAZ,CAAZ,CA9BV;;EAAA;EA8BF4H,gBAAAA,GA9BE;EA+BG7E,gBAAAA,CA/BH,GA+BO,CA/BP;;EAAA;EAAA,sBA+BUA,CAAC,GAAG6E,GAAG,CAAC5E,MA/BlB;EAAA;EAAA;EAAA;;EAgCA5B,gBAAAA,GAhCA,GAgCMwG,GAAG,CAAC7E,CAAD,CAhCT;;EAAA,oBAiCC3B,GAjCD;EAAA;EAAA;EAAA;;EAkCFgD,gBAAAA,OAAO,CAACC,KAAR,CAAc,kBAAkB6C,MAAM,CAACnE,CAAD,CAAN,CAAU/C,MAA1C;EAlCE;;EAAA;EAAA,4BAqCkEkH,MAAM,CAACnE,CAAD,CArCxE,EAqCG9C,CArCH,aAqCGA,CArCH,EAqCMC,CArCN,aAqCMA,CArCN,EAqCSuC,KArCT,aAqCSA,KArCT,EAqCgBc,MArChB,aAqCgBA,MArChB,EAqCwBjD,MArCxB,aAqCwBA,MArCxB,EAqCgCC,MArChC,aAqCgCA,MArChC,EAqCwCC,YArCxC,aAqCwCA,YArCxC,EAqCsDC,QArCtD,aAqCsDA,QArCtD;EAAA;EAAA,uBAsCE,KAAKV,SAAL,CACJqB,GADI,EAEJnB,CAFI,EAGJC,CAHI,EAIJuC,KAJI,EAKJc,MALI,EAMJ;EACEjD,kBAAAA,MAAM,EAANA,MADF;EAEEC,kBAAAA,MAAM,EAANA,MAFF;EAGEC,kBAAAA,YAAY,EAAZA,YAHF;EAIEC,kBAAAA,QAAQ,EAARA;EAJF,iBANI,CAtCF;;EAAA;EA+B0BsC,gBAAAA,CAAC,EA/B3B;EAAA;EAAA;;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;EAAA;;EAAA;EAAA;EAAA;EAAA;EAAA;;EAAA;EAAA,EAAsBvD,KAAtB,CAAV;;;;;;;;"}